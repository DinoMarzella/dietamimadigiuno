{% layout none %}
{% if cart.items.size > 0 %}
{%- assign cartItems = cart.items -%}
{% endif %} 
[
{% for item in cartItems %}

{% assign handle = item.url | split: '?' | first |replace :'/products/':'' %}
  
{% for prop in item.properties%}

  {% if prop.first == "_product" and prop.last !="" %}
  {% assign handle= prop.last %}
  {% endif%} 
{% endfor %}

{%  assign currentProduct = all_products[handle] %}
 
{% for v in currentProduct.variants %}
{% if v.id == item.variant_id %}
{% assign currentVariant= v %}

{% break %}
{% endif %} 
{% endfor %}
{% assign newPrice = "" %} 
 {%- capture newPrice -%}{{currentVariant.compare_at_price}}{%- endcapture -%}
{% if newPrice contains "33300" %}
{% assign newPrice = 24900 %}   
{% else %}   


{% assign newPrice = currentVariant.compare_at_price %}


{% endif %}      
 {% if currentVariant.metafields.my_fields.compare_at_price_frontend %}
 {% assign newPrice = currentVariant.metafields.my_fields.compare_at_price_frontend | times :100 %}
 
{% endif %}  
{% if newPrice contains '249'%}
  {% assign newPrice = 19900 %}
{% endif %} 
{
  "handle": {{handle | json }},
  "variant_id": {{item.variant_id | json}},
  "product_id": {{item.product_id | json}},
  "qty":{{item.quantity  | json}},
  "line_price":{{item.final_line_price |json}},
  "collections":{{currentProduct.collections  | json}},
  "tags":{{currentProduct.tags |json }},  
  "compare_at_price":{{newPrice |json }},
  "price":{{currentVariant.price |json }}, 
  "new_compare_value":"{{newPrice}}",
  "side_compare_at_price":{{newPrice | money_without_currency  | json }},
  "side_price":{{currentVariant.price | money_without_currency | json }}
     
 }  
 {% unless forloop.last %},{% endunless %}




{% endfor %}
]