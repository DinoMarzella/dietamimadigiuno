{% layout none %}
{% if cart.items.size > 0 %}
{%- assign cartItems = cart.items -%}
{% endif %} 
[
{% for item in cartItems %}

{% assign handle = item.url | split: '?' | first |replace :'/products/':'' %}
 
{% for prop in item.properties%}

  {% if prop.first == "_product" and prop.last !="" %}
  {% assign handle= prop.last %}
  {% endif%} 
{% endfor %}

{%  assign currentProduct = all_products[handle] %}
 
{% for v in currentProduct.variants %}
{% if v.id == item.variant_id %}
{% assign currentVariant= v %}

{% break %}
{% endif %} 
{% endfor %}
{% assign newPrice = "" %} 
 {%- capture newPrice -%}{{currentVariant.compare_at_price}}{%- endcapture -%}
{% if newPrice contains "33300" %}
{% assign newPrice = 24900 %}   
{% else %}  


{% assign newPrice = currentVariant.compare_at_price %}


{% endif %}      
 {% if currentVariant.metafields.my_fields.compare_at_price_frontend %}
 {% assign newPrice = currentVariant.metafields.my_fields.compare_at_price_frontend | times :100 %}
{% endif %} 
{
  "handle": {{handle | json }},
  "variant_id": {{item.variant_id | json}},
  "product_id": {{item.product_id | json}},
  "qty":{{item.quantity  | json}},   
  "special_gift":{{currentVariant.metafields.global.special_gift |  json }}, 
  "special_gift_2":{{currentVariant.metafields.global.special_gift_2 |  json }}, 
  "override_global_gift":"{{currentVariant.metafields.global.override_global_gift  }}",   
  "choose_gift":{{currentVariant.metafields.global.choose_gift |  json }},
  "current_variant_price":{{currentVariant.price || divided_by: 100 | json }}   
  
  
   
   
 }   
 {% unless forloop.last %},{% endunless %}


  

{% endfor %}
] 