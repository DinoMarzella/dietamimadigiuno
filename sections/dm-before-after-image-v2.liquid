{% assign data = section.settings %}
{% style %}
        .images-cont {
          position: relative;
          overflow: hidden;
          max-width: {{ data.image_max_width }};
          margin: 0 auto;
        }
        .images-cont .image-relative {
          position: relative;
          width: 100%;
        }
        @media screen and (min-width: 1024px) {
            .set-ratio {
                aspect-ratio: var(--ard);
            }
        }
        picture {
            display: block;
            height: fit-content;
        }
        .images-cont .image-absolute {
            position: absolute;
            top: 0;
            right: auto;
            height: 100%;
            overflow: hidden;
        }
        .images-cont .image-absolute picture {
            width: auto;
        }
        @keyframes slide_right {
          from {
            transform: translate3d(0%,0,0);
          }
          to {
            transform: translate3d(103%,0,0);
          }
        }
        @keyframes slide_right_out {
          from {
            transform: translate3d(103%,0,0);
          }
          to {
            transform: translate3d(0%,0,0);
          }
        }
        .animation-trigger {
          /* animation: slide_right 3s linear infinite;
          animation-play-state: paused;
          animation-name: slide_right;
          animation-duration: 3s;
          animation-timing-function: linear;
          animation-iteration-count: infinite;
          animation-delay: calc(var(--scroll) * -1s);
          animation-direction: alternate; */
          
          /* animation: slide_right 1s linear infinite;
          animation-play-state: paused;
          animation-delay: calc(var(--scroll) * -1s);
          animation-iteration-count: 1;
          animation-fill-mode: both; */

          animation-name: slide_right;
          animation-duration: 2s;
          animation-iteration-count: 1;
          animation-fill-mode: forwards;
          
        }
  .animation-trigger-out {
    animation-name: slide_right_out;
    animation-duration: 2s;
    animation-iteration-count: 1;
    animation-fill-mode: forwards;
  }
  
{% endstyle %}

<div id="b_a_image" class='py-6 lg:overflow-hidden font-harmonia md:py-12 {%- if data.remove_padding %} md:py-0 {%- endif -%}' style="background-color: {{data.background_color}}">  
  <div class='flex-col items-center justify-center'>
    <div class="w-full px-4 mx-auto sm:px-6 lg:items-center lg:px-0">
      {% if data.pretitle.size > 0 %}<p class="accent-subtitle text-center">{{data.pretitle}}</p>{% endif %}
      {%- if data.title -%}<h1 class="justify-center mx-auto mb-8 text-center uppercase font-harmonia item-center">{{data.title}}</h1>{%- endif -%}
    </div>
  </div>
  
  <div class="mx-auto {% if data.full_width %}w-full{% else %} max-w-screen-2xl lg:px-8{% endif %} md:flex">
    <div class='flex-col items-center justify-center md:flex-row flex-1 md:block hidden'>
      <div class="w-full px-4 mx-auto sm:px-6 lg:items-center lg:px-0">
      {%- if data.content_sx -%}<div class='content flex content-left px-5 text-lg text-left text-black md:px-10 font-avenir'>{{data.content_sx}}</div>{%- endif -%}
      </div>
    </div>
    <div id="ba-image-section" class="images-cont flex flex-col items-center justify-center md:flex-row flex-1">
      <div class="ba-image-wrapper">
        <div class="image-relative">
            <picture iesrc="{{ data.image | img_url: 'master'  }}" class="picture set-ratio" style="--arm: 750/550; --ard: 650/470;">
                <source media="(max-width:1023px)" srcset="{{ data.image | img_url: 'master'  }}">
                <img src="{{ data.image | img_url: 'master'  }}" alt="Box Image">
            </picture>
        </div>
        <div id="clip-path" class="image-absolute flex items-center justify-center">
            <picture iesrc="{{ data.image2 | img_url: 'master'  }}" class="picture set-ratio" style="--arm: 750/550; --ard: 650/470;">
                <source media="(max-width:1023px)" srcset="{{ data.image2 | img_url: 'master'  }}">
                <img src="{{ data.image2 | img_url: 'master'  }}" alt="Box Image">
            </picture>
        </div>
      </div>
    </div>
    <div class='flex-col items-center justify-center md:flex-row flex-1'>
      <div class="w-full px-4 mx-auto sm:px-6 lg:items-center lg:px-0">
      {%- if data.content_sx -%}<div class='content flex content-left px-5 text-lg text-left text-black md:px-10 font-avenir md:hidden'>{{data.content_sx}} {{data.content_dx}}</div>{%- endif -%}
      {%- if data.content_dx -%}<div class='content content-right px-5 text-lg text-left text-black md:px-10 font-avenir md:flex hidden'>{{data.content_dx}}</div>{%- endif -%}
      </div>
    </div>
  </div>
  <div class='text-center items-center justify-center w-full max-w-sm px-5 mx-auto mt-5 md:px-10 sm:flex sm:max-w-none'>
  {%- if section.blocks.size > 0 -%}
    {% for button in section.blocks %}
      <div>{%- render 'TWButtons', button: button-%}</div>
    {% endfor %}
  {%- endif -%}
  </div>
</div>

   <script>
     (function() {
        const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    const square = entry.target.querySelector('.image-absolute');

    if (entry.isIntersecting) {
      square.classList.add('animation-trigger');
	  return; // if we added the class, exit the function
    }

    // We're not intersecting, so remove the class!
    square.classList.remove('animation-trigger');
  });
});

observer.observe(document.querySelector('.ba-image-wrapper'));
    })();
     </script>

     <script>
     $(document).ready(function() {
       window.addEventListener('scroll', () => {
         document.body.style.setProperty('--scroll',window.pageYOffset / (document.body.offsetHeight - window.innerHeight));
       }, false);
     });
   </script>
   
{% schema %}
{
    "name": "DM Before/After image v2", 
    "settings": [
    {
      "type": "text",
      "id": "pretitle",
      "label": "Pre Title"
    },
      {
        "type": "textarea",
        "id": "title",
        "label": "Title",
        "default": "Title"
      },
      {
        "type": "html",
        "id": "content_sx",
        "label": "Contenuto SX",
        "default": "<p>Content</p>"
      },
            {
        "type": "html",
        "id": "content_dx",
        "label": "Contenuto DX",
        "default": "<p>Content</p>"
      },
       {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
      },
       {
            "type": "image_picker",
            "id": "image2",
            "label": "Image"
      },
      {
        "type": "checkbox",
        "id": "full_width",
        "label": "Full Width",
       "default": false
      }, 
      {
        "type": "checkbox",
        "id": "remove_padding",
        "label": "Remove Top Bottom Padding"
      },
      {
        "type": "color",
        "id": "background_color",
        "label": "Background Color",
        "default": "#ffffff"
      },
      {
        "type": "text",
        "id": "image_max_width",
        "label": "Image Max Width (Required)",
        "default": "600px"
      },
      {
        "type": "text",
        "id": "image_min_height",
        "label": "Image Min Height (Required)",
        "default": "500px"
      },
      {
        "type": "text",
        "id": "tag",
        "label": "Tag"
      }
    ],
    "blocks": [
      {
        "type": "buttons",
        "name": "Buttons",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "Text"
          },
          {
            "type": "url",
            "id": "url",
            "label": "Url"
          },
      {
        "type": "select",
        "id": "button_type",
        "label": "Button Type",
        "default": "primary",
        "options": [
          {
            "label": "primary",
            "value": "primary"
          },
          {
            "label": "secondary",
            "value": "secondary"
          }
        ]
      }
        ]
      }
    ],
    "presets": [
          {
            "name": "DM Before/After image v2"
          }
    ]
  }
{% endschema %}