<style>

.popup-patient-email-popup .popup-wrapper-email {
    position: fixed;
    height: 100vh;
    width: 100vw;
    background: Rgb(0 0 0/72%);
    display: flex;
    z-index: 5;
    top: 100px;
    align-items: center;
    justify-content: center;
    left: 0;
    top: 0;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    z-index: 999999;
}

.popup-patient-email-popup .popup-wrapper-email .for-returning-patients {
    display: flex!Important;;
    background: white;
    width: 500px;
    padding: 10px;
    height: 400px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    max-width: 100%;
}

.popup-patient-email-popup .popup-wrapper-email label.patient-email {
    display: flex;
    flex-direction: column;
    text-align: center;
}

.popup-patient-email-popup .popup-wrapper-email button.btn-submit {
    background: orange;
    padding: 10px;
}

.popup-patient-email-popup .popup-wrapper-email .patient-question {
    margin-bottom: 10px;
    font-size: 20px;
    display: none;
}


.popup-patient-email-popup .popup-wrapper-email .for-returning-patients h2 {
    margin-bottom: 20px;
}

.popup-patient-email-popup .popup-for-patient-email {
    width: 100%;
}

.popup-patient-email-popup .popup-wrapper-email form.patient-email {
    max-width: 300px;
    width: 100%;
}
.popup-patient-email-popup .popup-wrapper-email label.patient-email span {
    margin-bottom: 10px;
} 
</style>
<div class="popup-wrapper-email">
<div class="for-returning-patients" style="display:none">
    <h2>
        Returning Patients
    </h2>
    <div class="patient-question">
        Please input your email address.
    </div>
    <form action="" class="patient-email">
        <div class="popup-for-patient-email">
            <label class="patient-email">
                <span>Please Enter Your Email Address</span>
                <input required type="email" class="email" name="email" placeholder="Email Address">
                <button class="btn-submit">Search</button>
                <a href="" class="go-back" style="display: block;text-align: center;margin-top: 10px;">Go Back</a>
            </label>
        </div> 


    </form>
</div>
</div>

<script>

$(document).on('click','.popup-for-patient-email .go-back',function(e){
    e.preventDefault(); 
    $(body).removeClass('popup-patient-email-popup');
});

$(document).on('click','.popup-for-patient-email .btn-submit',async function(e){


    e.preventDefault();

    $('.popup-for-patient-email .btn-submit').text(`Searching...`);
    var email = $('.popup-for-patient-email .email').val();
    if(!email){
        alert('Please enter your email address');
        return false;
    }
    let url = `https://prolon-pro.herokuapp.com/stores/get-customer-related-doctor?shop={{shop.permanent_domain}}&email=${email}`;
    try {
        let CustomerResponse = await jQuery.getJSON(url);
        let data = CustomerResponse;
        if (!data.HcpCode) {
            alert('Patient not found, Please be sure to enter the email address you used to purchase your ProLon box.');
        } else {
            if (data.HcpCode) {
                selectDoctor(data.HcpCode);
                alert(`You Provider is ${data.paidToHCP}. Adding to Cart now...`);
                if(window.do_AddTotCart && window.last_selected_variant)
                {
                    try{
                    let item = window.last_selected_variant.item;
                    let context= window.last_selected_variant.context;
                    window.do_AddTotCart(item,context);
                    }
                    catch(ex){

                    }
                    
                }
                $('body').removeClass('popup-patient-email-popup'); 
            }
        }
    }
    catch (ex) {
       alert('Patient not found, Please be sure to enter the email address you used to purchase your ProLon box.');
    } 
    $(`.popup-for-patient-email .btn-submit`).text(`Search`); 



})


</script>